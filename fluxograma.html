<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluxograma Detalhado: OCR e Extra√ß√£o de Dados</title>
    <style>
        body {
            font-family: FreeMono, monospace;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 20px;
            background-color: #08225e;
            overflow-x: auto;
        }
        h1 {
            text-align: center;
            color: whitesmoke;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        .flowchart {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            flex-wrap: wrap; /* Ajuste para permitir que os elementos quebrem linha */
        }
        .step-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 40px;
            margin-bottom: 40px;
            flex-basis: 100%; /* O cont√™iner ocupar√° 100% do espa√ßo no modo mobile */
            max-width: 300px; /* Definindo um valor m√°ximo para controlar o tamanho em telas grandes */
        }
        .number {
            color: #ecf0f1;
            font-size: 20px;
            font-weight: bold;
        }
        .step {
            background-color: #202020;
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            width: 100%; /* Ajuste para responsividade */
            max-width: 250px; /* Mant√©m o tamanho m√°ximo mesmo em telas grandes */
            height: 100px; /* Remove a altura fixa para que o conte√∫do n√£o quebre */
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .step:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .substeps {
            display: none;
            background-color: #ecf0f1;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            width: 100%;
            max-width: 250px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .substep {
            background-color: #bb2949;
            color: white;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .substep:hover {
            background-color: #9e2236;
        }
        .explanation {
            display: none;
            background-color: #f9f9f9;
            border-left: 5px solid #bb2949;
            color: black;
            padding: 10px;
            margin-top: 5px;
            font-size: 0.9em;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        @media (max-width: 600px) {
            .flowchart {
                flex-direction: column;
                align-items: center;
            }
            .step-container {
                margin-right: 0;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <h1><img src="G:\Meu Drive\DEV\PP_antifraude\app\src\Pepe_Pose_C_FLAT (p).png" width="200"
        height="200" />FLUXO: PP ANTIFRAUDE</h1>
    <div class="flowchart">
        <div class="step-container">
            <div class="number">1</div>
            <div class="step" onclick="toggleSubsteps(this)">ü§ñ<br> Captura de Documentos (Selenium e Power Automate)</div>
            <div class="substeps">
                <div class="substep" onclick="toggleExplanation(this)">1.1. Listagem de Processos
                    <div class="explanation">
                        a. Identificar processos que requerem captura de documentos<br>
                        b. Criar lista priorizada de processos para captura<br>
                        c. Verificar status atual de cada processo<br>
                        d. Atualizar lista de captura conforme necess√°rio
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">1.2. Automa√ß√£o com RPA (Selenium)
                    <div class="explanation">
                        a. Scripts em Python utilizando Selenium<br>
                        b. Navega√ß√£o web automatizada<br>
                        c. Seletores para identifica√ß√£o de elementos na p√°gina<br>
                        d. L√≥gica de extra√ß√£o e download de documentos<br>
                        e. Gerenciar sess√µes e cookies para manter autentica√ß√£o
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">1.3. Automa√ß√£o com RPA (Power Automate)
                    <div class="explanation">
                        a. Fluxos de trabalho no Power Automate<br>
                        b. Conectores para sistemas relevantes e da justi√ßa<br>
                        c. A√ß√µes para navega√ß√£o e extra√ß√£o de dados<br>
                        d. Vari√°veis e express√µes para l√≥gica de neg√≥cios<br>
                        e. Configurar tratamento de erros e notifica√ß√µes
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">1.4. Armazenamento no Google Drive
                    <div class="explanation">
                        a. Conex√£o segura com o Google Drive<br>
                        b. Pastas para organiza√ß√£o dos documentos<br>
                        c. L√≥gica de nomea√ß√£o de arquivos<br>
                        d. Permiss√µes de acesso apropriadas
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">1.5. Controle e Monitoramento
                    <div class="explanation">
                        a. Gera√ß√£o de logs de captura para cada documento<br>
                        b. Dashboard para acompanhamento do progresso<br>
                        c. Alertas para falhas ou atrasos na captura<br>
                        d. Estabelecer processo de revis√£o e corre√ß√£o de erros<br>
                        e. Verificar efici√™ncia das capturas 
                    </div>
                </div>
            </div>
        </div>
        <div class="arrow"></div>
        <div class="step-container">
            <div class="number">2</div>
            <div class="step" onclick="toggleSubsteps(this)">üîç<br> Processamento de Documentos (OCR e Leitura de C√≥d. de Barras)</div>
            <div class="substeps">
                <div class="substep" onclick="toggleExplanation(this)">2.1. Abertura e Verifica√ß√£o do PDF
                    <div class="explanation">
                        a. Abrir arquivo PDF usando pdfplumber<br>
                        b. Verificar tamanho do arquivo<br>
                        c. Se necess√°rio, comprimir o PDF usando a fun√ß√£o comprimir_pdf<br>
                        d. Tratamento de erro: Captura exce√ß√µes ao abrir arquivos corrompidos
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">2.2. OCR usando OCR.space API
                    <div class="explanation">
                        a. Prepara requisi√ß√£o para OCR.space API<br>
                        b. Envia arquivo PDF para OCR.space API<br>
                        c. Recebe e processar resposta da API<br>
                        d. Extrae texto do resultado da API<br>
                        e. Tratamento de erro: Lidar com falhas de conex√£o e respostas inesperadas da API
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">2.3. OCR Adicional com Tesseract
                    <div class="explanation">
                        a. Usar pdfplumber para extrair texto de p√°ginas com conte√∫do suficiente<br>
                        b. Para p√°ginas com pouco texto, converter para imagem e usar pytesseract<br>
                        c. Aplicar pr√©-processamento na imagem (convers√£o para escala de cinza)<br>
                        d. Tratamento de erro: Lidar com falhas no processamento de imagens
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">2.4. Leitura de C√≥digo de Barras
                    <div class="explanation">
                        a. Converter p√°ginas do PDF para imagens de alta resolu√ß√£o<br>
                        b. Usar zxingcpp e vis√£o computacional para detectar e ler c√≥digos de barras<br>
                        c. Armazenar informa√ß√µes dos c√≥digos de barras detectados no arquivo de texto da OCR<br>
                        d. Tratamento de erro: Lidar com c√≥digos de barras ileg√≠veis ou danificados
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">2.5. P√≥s-processamento de Texto
                    <div class="explanation">
                        a. Aplica corre√ß√µes e limpeza no texto extra√≠do usando regex<br>
                        b. Remove padr√µes espec√≠ficos como assinaturas eletr√¥nicas<br>
                        c. Padroniza o formato do texto (lowercase, remo√ß√£o de espa√ßos extras)<br>
                        d. Corre√ß√£o: Implementar verifica√ß√µes adicionais para garantir integridade dos dados
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">2.6. Medidas de Seguran√ßa
                    <div class="explanation">
                        a. Implementar verifica√ß√£o de tipos de arquivos para prevenir inje√ß√£o de c√≥digo malicioso<br>
                        b. Limitar o tamanho m√°ximo de arquivo process√°vel<br>
                        c. Sanitizar entradas para prevenir ataques de inje√ß√£o<br>
                        d. Implementar logging seguro para rastrear opera√ß√µes e detectar anomalias
                    </div>
                </div>
            </div>
        </div>
        <div class="arrow"></div>
        <div class="step-container">
            <div class="number">3</div>
            <div class="step" onclick="toggleSubsteps(this)">üß†<br> Extra√ß√£o de Dados com LLM</div>
            <div class="substeps">
                <div class="substep" onclick="toggleExplanation(this)">3.1. Prepara√ß√£o para o LLM
                    <div class="explanation">
                        a. Configura cliente Groq e carregar chave API de forma segura (variavel de ambiente)<br>
                        b. Define fun√ß√£o com prompt do sistema para o LLM com instru√ß√µes detalhadas da extra√ß√£o dos dados<br>
                        c. Formatar o texto extra√≠do para envio ao LLM<br>
                        d. Seguran√ßa: Implementar rota√ß√£o regular de chaves API
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">3.2. Processamento com LLM
                    <div class="explanation">
                        a. Enviar texto para o modelo LLM (llama3-70b-8192)<br>
                        b. Receber resposta do LLM em formato JSON<br>
                        c. Extrae e valida o JSON da resposta<br>
                        d. Tratamento de erro: Implementar retry com backoff exponencial para falhas de API
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">3.3. P√≥s-processamento do JSON
                    <div class="explanation">
                        a. Corrige e limpa o JSON recebido usando regex<br>
                        b. Verifica e corrigi erros comuns no JSON<br>
                        c. Converte o JSON em um dicion√°rio Python<br>
                        d. Tratamento de erro: Implementar fallback para JSON mal formatado
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">3.4. Extra√ß√£o de Dados Espec√≠ficos
                    <div class="explanation">
                        a. Classifiica documento e Extrai informa√ß√µes baseadas no tipo de documento<br>
                        b. Processar campos espec√≠ficos (nome, endere√ßo, c√≥digos)<br>
                        c. Adicionar c√≥digos de barra lidos separadamente ao JSON, mantendo a extra√ß√£o de codigo de barras pela LLM e por script <br>
                        d. Corre√ß√£o: Implementar valida√ß√µes de formato para campos cr√≠ticos
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">3.5. Medidas de Seguran√ßa de Dados
                    <div class="explanation">
                        a. Implementar mascaramento de dados sens√≠veis (ex: CPF, n√∫meros de cart√£o)<br>
                        b. Garantir que dados sens√≠veis n√£o sejam logados ou armazenados desnecessariamente<br>
                        c. Implementar criptografia para dados em repouso e em tr√¢nsito<br>
                        d. Estabelecer pol√≠ticas de reten√ß√£o e exclus√£o de dados
                    </div>
                </div>
            </div>
        </div>
        <div class="arrow"></div>
        <div class="step-container">
            <div class="number">4</div>
            <div class="step" onclick="toggleSubsteps(this)">üíæ<br> Armazenamento de Dados</div>
            <div class="substeps">
                <div class="substep" onclick="toggleExplanation(this)">4.1. Conex√£o com o Banco de Dados
                    <div class="explanation">
                        a. Estabelecer conex√£o segura com o banco de dados PostgreSQL<br>
                        b. Implementar pool de conex√µes para gerenciar m√∫ltiplas conex√µes<br>
                        c. Configurar timeouts e reconex√µes autom√°ticas<br>
                        d. Tratamento de erro: Implementar mecanismo de retry para falhas de conex√£o
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">4.2. Prepara√ß√£o dos Dados
                    <div class="explanation">
                        a. Validar e sanitizar os dados extra√≠dos antes do armazenamento<br>
                        b. Converter formatos de dados conforme necess√°rio (datas, n√∫meros, etc.)<br>
                        c. Gerar identificadores √∫nicos para cada registro, se aplic√°vel<br>
                        d. Implementar l√≥gica para detectar e lidar com registros duplicados
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">4.3. Inser√ß√£o nas Tabelas Espec√≠ficas
                    <div class="explanation">
                        a. Mapear dados extra√≠dos para as tabelas correspondentes:<br>
                        - public.rotinas_documentos_tjam<br>
                        - Custom.Tjam_documentos_conta_energia<br>
                        - Custom.Tjam_documentos_conta_Telefone<br>
                        - Custom.Tjam_documentos_conta_agua<br>
                        - Custom.Tjam_procuracao_judicial<br>
                        - Custom.Tabs_documentos_bancario<br>
                        b. Utilizar prepared statements para inser√ß√µes seguras e eficientes<br>
                        c. Implementar l√≥gica de upsert (INSERT ou UPDATE) quando apropriado<br>
                        d. Tratamento de erro: Implementar rollback em caso de falhas parciais
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">4.4. Controle de Transa√ß√µes
                    <div class="explanation">
                        a. Iniciar transa√ß√£o para cada conjunto de inser√ß√µes relacionadas<br>
                        b. Implementar pontos de commit para grandes volumes de dados<br>
                        c. Utilizar mecanismo de savepoint para recupera√ß√£o parcial em caso de erros<br>
                        d. Garantir atomicidade das opera√ß√µes para manter integridade dos dados
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">4.5. Logging e Auditoria
                    <div class="explanation">
                        a. Registrar todas as opera√ß√µes de inser√ß√£o e atualiza√ß√£o no banco de dados<br>
                        b. Implementar trilha de auditoria para rastrear mudan√ßas nos dados<br>
                        c. Armazenar metadados como timestamp, usu√°rio respons√°vel e origem dos dados<br>
                        d. Configurar alertas para opera√ß√µes em massa ou padr√µes incomuns de inser√ß√£o
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">4.6. Medidas de Seguran√ßa
                    <div class="explanation">
                        a. Implementar criptografia para dados sens√≠veis no banco de dados<br>
                        b. Utilizar conex√µes SSL/TLS para comunica√ß√£o com o banco de dados<br>
                        c. Aplicar princ√≠pio de menor privil√©gio para acessos ao banco de dados<br>
                        d. Realizar backups regulares e testar procedimentos de recupera√ß√£o
                    </div>
                </div>
            </div>
        </div>
        <div class="arrow"></div>
        <div class="step-container">
            <div class="number">5</div>
            <div class="step" onclick="toggleSubsteps(this)">üïµÔ∏è<br> An√°lise e Relat√≥rio</div>
            <div class="substeps">
                <div class="substep" onclick="toggleExplanation(this)">5.1. Extra√ß√£o e Transforma√ß√£o de Dados (ETL)
                    <div class="explanation">
                        a. Extra√ß√£o: Coletar dados de documentos processados (ex: PDFs, imagens) e de banco de dados<br>
                        b. Transforma√ß√£o: Processar os dados extra√≠dos, incluindo limpeza, normaliza√ß√£o e enriquecimento<br>
                        c. Carregamento: Armazenar dados transformados em um banco de dados para consulta e an√°lise futura<br>
                        d. Implementar procedimentos de agendamento para ETL regular
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">5.2. An√°lise de Dados
                    <div class="explanation">
                        a. Analisar dados extra√≠dos para identificar padr√µes e insights<br>
                        b. Utilizar ferramentas de BI (Business Intelligence) para visualiza√ß√£o de dados<br>
                        c. Realizar an√°lises estat√≠sticas e relat√≥rios de tend√™ncia<br>
                        d. Criar dashboards din√¢micos para facilitar a visualiza√ß√£o
                    </div>
                </div>
                <div class="substep" onclick="toggleExplanation(this)">5.3. Ind√≠cios de Fraude
                    <div class="explanation">
                        a. Cruzamento dos dados entre todos documentos armazenados<br>
                        b. Identificar padr√µes de comportamento suspeitos, como:<br>
                        <table>
                            <tr>
                                <th>DOC</th>
                                <th>TIPO DE IF</th>
                                <th>QTD DOC COM IF</th>
                            </tr>
                            <tr>
                                <td>CE</td>
                                <td>Pessoas distintas com a mesma nota_fiscal</td>
                                <td>124</td>
                            </tr>
                            <tr>
                                <td>CE</td>
                                <td>Pessoas distintas com o mesmo codigo_barras</td>
                                <td>123</td>
                            </tr>
                            <tr>
                                <td>CE</td>
                                <td>Pessoas distintas com o mesmo numero_medidor</td>
                                <td>99</td>
                            </tr>
                            <tr>
                                <td>TEL</td>
                                <td>Pessoas distintas com o mesmo numero_telefone</td>
                                <td>81</td>
                            </tr>
                        </table>
                        c. Analisar documentos que apresentem ind√≠cios de fraude<br>
                        d. Implementar procedimentos de investiga√ß√£o para documentos identificados<br>
                        e. Relatar ind√≠cios de fraude √†s autoridades competentes, se necess√°rio
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleSubsteps(element) {
            const substeps = element.nextElementSibling;
            if (substeps.style.display === "none" || substeps.style.display === "") {
                substeps.style.display = "block";
            } else {
                substeps.style.display = "none";
            }
        }

        function toggleExplanation(element) {
            const explanation = element.querySelector('.explanation');
            if (explanation.style.display === "none" || explanation.style.display === "") {
                explanation.style.display = "block";
            } else {
                explanation.style.display = "none";
            }
        }
    </script>
</body>
</html>